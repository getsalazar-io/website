---
interface Props {
  title: string;
  description: string;
  group?: string;
  defaultOpen?: boolean;
}

const { title, description, group, defaultOpen = false } = Astro.props;
---

<div class="accordion" data-accordion-group={group}>
  <button
    class="accordion-header"
    aria-expanded={defaultOpen ? "true" : "false"}
  >
    <span class="accordion-title">{title}</span>
    <span
      class={`accordion-icon pi ${defaultOpen ? "pi-minus" : "pi-plus"}`}
      aria-hidden="true"></span>
  </button>
  <div class="accordion-content" style={defaultOpen ? "" : ""}>
    <div class="accordion-description">
      <p>{description}</p>
    </div>
  </div>
</div>

<style>
  .accordion {
    overflow: hidden;
  }

  .accordion-header {
    width: 100%;
    display: flex;
    gap: 8px;
    justify-content: space-between;
    align-items: center;
    padding: 20px 24px;
    background: transparent;
    border: none;
    cursor: pointer;
    transition: background-color 0.3s ease;
  }

  .accordion-title {
    font-size: 18px;
    font-weight: 600;
    color: #fff;
    text-align: left;
  }

  .accordion-icon {
    font-size: 24px;
    font-weight: 300;
    color: #fff;
    transition: color 0.3s ease;
    line-height: 1;
  }

  .accordion-header[aria-expanded="true"] .accordion-icon {
    color: rgba(98, 186, 243, 1);
  }

  .accordion-content {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.4s ease;
    margin: 0 24px;
    text-align: left;
  }

  .accordion-description {
    padding: 20px;
    background-color: rgba(31, 57, 73, 0.8);
    border-radius: 20px;
  }

  .accordion-description p {
    margin: 0;
    color: rgba(235, 235, 235, 1);
    line-height: 1.6;
    max-width: 600px;
  }
</style>

<script>
  function closeAccordion(
    button: Element,
    content: HTMLElement,
    icon: HTMLElement
  ) {
    button.setAttribute("aria-expanded", "false");
    content.style.maxHeight = "0";
    icon.classList.remove("pi-minus");
    icon.classList.add("pi-plus");
  }

  function openAccordion(
    button: Element,
    content: HTMLElement,
    icon: HTMLElement
  ) {
    button.setAttribute("aria-expanded", "true");
    content.style.maxHeight = content.scrollHeight + "px";
    icon.classList.remove("pi-plus");
    icon.classList.add("pi-minus");
  }

  function initializeAccordionHeights() {
    document
      .querySelectorAll('.accordion-header[aria-expanded="true"]')
      .forEach((button) => {
        const content = button.nextElementSibling as HTMLElement;
        if (content) {
          content.style.maxHeight = content.scrollHeight + "px";
        }
      });
  }

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initializeAccordionHeights);
  } else {
    initializeAccordionHeights();
  }

  window.addEventListener("load", () => {
    setTimeout(initializeAccordionHeights, 100);
  });

  document.querySelectorAll(".accordion-header").forEach((button) => {
    button.addEventListener("click", () => {
      const isExpanded = button.getAttribute("aria-expanded") === "true";
      const content = button.nextElementSibling as HTMLElement;
      const icon = button.querySelector(".accordion-icon") as HTMLElement;
      const accordion = button.closest(".accordion") as HTMLElement;
      const group = accordion?.dataset.accordionGroup;

      if (group) {
        document
          .querySelectorAll(
            `.accordion[data-accordion-group="${group}"] .accordion-header`
          )
          .forEach((otherButton) => {
            if (
              otherButton !== button &&
              otherButton.getAttribute("aria-expanded") === "true"
            ) {
              const otherContent =
                otherButton.nextElementSibling as HTMLElement;
              const otherIcon = otherButton.querySelector(
                ".accordion-icon"
              ) as HTMLElement;
              closeAccordion(otherButton, otherContent, otherIcon);
            }
          });
      }

      if (isExpanded) {
        closeAccordion(button, content, icon);
      } else {
        openAccordion(button, content, icon);
      }
    });
  });
</script>
