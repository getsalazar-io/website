---
import { t } from "i18next";

interface Props {
  videoUrl: string;
}

const { videoUrl } = Astro.props;
---

<div class="modal-overlay" id="videoModal">
  <button class="modal-close" id="closeModal">
    <span class="pi pi-times"></span>
  </button>
  <div class="modal-content">
    <video controls id="modalVideo">
      <source src={videoUrl} type="video/mp4" />
      {t("section.hero.modal-alt")}
    </video>
    <img
      src="/images/bg_planet_Hero.webp"
      alt={t("images.planetBig")}
      class="planet"
      loading="lazy"
    decoding="async"
    />
  </div>
</div>

<style>
  .modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    background: #0b0b0b80;
    backdrop-filter: blur(24px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 9999;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .modal-overlay.active {
    display: flex;
    opacity: 1;
  }

  .modal-content {
    width: 90%;
    height: 80%;
    background: #000;
    border-radius: 8px;
    overflow: hidden;
    display: flex;
    justify-content: center;
    align-items: center;
    border: 1px solid var(--primary-200, #83d4f8);
    box-shadow: 0px 0px 144px -70px var(--primary200, #83d4f8);
    background-image: url("/images/bg_planet_Hero.webp");
    background-size: contain;
    background-position: top right;
    background-repeat: no-repeat;
    background-position-y: -200px;
    position: relative;
  }

  video {
    width: 100%;
    height: 100%;
    object-fit: contain;
    max-width: 1000px;
    z-index: 1;
  }

  .modal-close {
    position: absolute;
    top: 20px;
    right: 20px;
    width: 48px;
    height: 48px;
    border: 2px solid white;
    background: transparent;
    border-radius: 50%;
    display: flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    z-index: 10000;
    transition: all 0.3s ease;
  }

  .modal-close span {
    color: white;
    font-size: 12px;
  }

  .planet {
    position: absolute;
    height: 1218px;
    width: auto;
    top: 200px;
    left: -500px;
    will-change: transform;
    z-index: 0;
  }

  @media screen and (max-width: 768px) {
    .modal-content {
      width: 90%;
      height: 70%;
    }

    .modal-close {
      top: 10px;
      right: 10px;
      width: 40px;
      height: 40px;
    }

    .modal-close span {
      font-size: 20px;
    }
  }
</style>

<script>
  document.addEventListener("DOMContentLoaded", () => {
    const modal = document.getElementById("videoModal");
    const closeBtn = document.getElementById("closeModal");
    const video = document.getElementById("modalVideo") as HTMLVideoElement;
    const header = document.querySelector(".header") as HTMLElement;
    const scrollDown = document.getElementById("scrollDown");

    const openModal = () => {
      modal?.classList.add("active");
      if (header) header.style.display = "none";
      document.body.style.overflow = "hidden";
      scrollDown?.classList.add("hidden");
    };

    const closeModal = () => {
      modal?.classList.remove("active");
      if (header) header.style.display = "flex";
      document.body.style.overflow = "";
      video?.pause();
      if (video) video.currentTime = 0;
      scrollDown?.classList.remove("hidden");
    };

    closeBtn?.addEventListener("click", closeModal);

    modal?.addEventListener("click", (e) => {
      if (e.target === modal) {
        closeModal();
      }
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape" && modal?.classList.contains("active")) {
        closeModal();
      }
    });

    (window as any).openVideoModal = openModal;
  });
</script>
